"use strict";angular.module("angularStates",["ngCookies"]),angular.module("angularStates").factory("StatesService",["$window","$rootElement",function(a,b){function c(a,b,c,d){a!==b&&("object"==typeof a&&b&&b!==a?angular.copy(b,a):f.mapping[c].instance[d]=b)}function d(a,b){b.value?f.mapping[a].data[b.name]=b.value:e(a,b.name),b.expire&&(f.mapping[a].expire[b.name]=b.expire)}function e(a,b){f.mapping[a].data[b]=void 0}var f={namespace:b.attr("ng-app")?b.attr("ng-app")+".":"",mapping:{},register:function(a,b,c){if(void 0!==f.mapping[b])throw new Error('keyName "'+b+'" already in use.');f.mapping[b]={instance:a,data:{},expire:{}},c.map(function(a){var c=typeof a;switch(c){case"object":d(b,a);break;case"string":e(b,a)}})},saveState:function(b){var c,d,e=f.mapping[b].instance,g=new Date,h=f.mapping[b].data;Object.keys(h).forEach(function(h){if(c=e[h],h=f.namespace+h,"undefined"!=typeof c){var i={value:c};f.mapping[b].expire[h]&&(d=new Date(g.getTime()+f.mapping[b].expire[h]),i.expire=d),i=JSON.stringify(i),a.localStorage.setItem(h,i)}else a.localStorage.removeItem(h)})},recoverState:function(b){var d,e,g=f.mapping[b].instance,h=f.mapping[b].data,i=new Date;Object.keys(h).forEach(function(h){e=f.namespace+h,d=a.localStorage.getItem(e),d?(d=JSON.parse(d),!d.expire||new Date(d.expire)>i?c(g[h],d.value,b,h):c(g[h],f.mapping[b].data[h],b,h)):c(g[h],f.mapping[b].data[h],b,h)})},resetState:function(a){f.recoverState(a),f.clearStorage(a)},clearStorage:function(b){var c,d=f.mapping[b].data;Object.keys(d).forEach(function(b){c=f.namespace+b,a.localStorage.removeItem(c)})}};return f}]);